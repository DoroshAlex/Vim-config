<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <title>Шаблоны проектирования</title>

 </head>
 <body><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="language.oop5.iterations.html">Итераторы объектов</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="language.oop5.magic.html">Магические методы</a></div>
 <div class="up"><a href="language.oop5.html">Классы и объекты</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="language.oop5.patterns" class="sect1">
 <h2 class="title">Шаблоны проектирования</h2>
 <p class="para">
  Шаблоны - это способ описания оптимальных методов и хороших
  дизайнов проектирования. Они предоставляют универсальные пути
  решения общих проблем программирования.
 </p>

 <div class="sect2" id="language.oop5.patterns.factory">
  <h3 class="title">Фабрика (Factory)</h3>
  <p class="para">
   Шаблон Фабрика позволяет создавать объекты во время работы программы.
   Этот шаблон называется Фабрикой потому, что он отвечает за
   производство объекта. Параметризированная фабрика принимает в
   качестве аргумента имя класса, объект которого создается.
  </p>
  <div class="example" id="example-203">
   <p><b>Пример #1 Параметризированный фабричный метод</b></p>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Example<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;Параметризированный&nbsp;фабричный&nbsp;метод<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">factory</span><span style="color: #007700">(</span><span style="color: #0000BB">$type</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(include_once&nbsp;</span><span style="color: #DD0000">'Drivers/'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$type&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">'.php'</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$classname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">'Driver_'&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$type</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;new&nbsp;</span><span style="color: #0000BB">$classname</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;throw&nbsp;new&nbsp;</span><span style="color: #0000BB">Exception</span><span style="color: #007700">(</span><span style="color: #DD0000">'Драйвер&nbsp;не&nbsp;найден'</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>
    Определение этого метода в классе позволяет драйверам быть
    загруженными &quot;на лету&quot;. В случае, если класс <i>Example</i>
    был бы классом абстрактного доступа к базе данных, то загрузка
    драйвера <i>MySQL</i> и <i>SQLite</i>
    может быть выполнена следующим образом:
   </p></div>
   <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;Загрузка&nbsp;драйвера&nbsp;MySQL<br /></span><span style="color: #0000BB">$mysql&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">factory</span><span style="color: #007700">(</span><span style="color: #DD0000">'MySQL'</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;Загрузка&nbsp;драйвера&nbsp;SQLite<br /></span><span style="color: #0000BB">$sqlite&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">factory</span><span style="color: #007700">(</span><span style="color: #DD0000">'SQLite'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
 </div>

 <div class="sect2" id="language.oop5.patterns.singleton">
  <h3 class="title">Синглтон (Singleton)</h3>
  <p class="para">
   Шаблон проектирования Синглтон применяется в тех ситуациях,
   когда нужно получить единственный экземпляр класса. Синглтон является
   одним из четырех(&quot;Gang of Four&quot;) основных создающих шаблонов.
  </p>
  <p class="para">Синглтон обычно применяется в классах для баз данных, логирования, контроллеров(Front
   Controller) и объектах, определяющих запросы и ответы(Request и Response).
  </p>

  <div class="example" id="example-204">
   <p><b>Пример #2 Пример Синглтона</b></p>
   <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #007700">class&nbsp;</span><span style="color: #0000BB">Example<br /></span><span style="color: #007700">{<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;static&nbsp;</span><span style="color: #0000BB">$instance</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;</span><span style="color: #0000BB">$count&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;private&nbsp;function&nbsp;</span><span style="color: #0000BB">__construct</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;static&nbsp;function&nbsp;</span><span style="color: #0000BB">singleton</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!isset(</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">'Создание&nbsp;нового&nbsp;экземпляра.'</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$className&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">__CLASS__</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">$className</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">self</span><span style="color: #007700">::</span><span style="color: #0000BB">$instance</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">increment</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">count</span><span style="color: #007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__clone</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">'Клонирование&nbsp;запрещено.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public&nbsp;function&nbsp;</span><span style="color: #0000BB">__wakeup</span><span style="color: #007700">()<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">trigger_error</span><span style="color: #007700">(</span><span style="color: #DD0000">'Десериализация&nbsp;запрещена.'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">E_USER_ERROR</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

   <div class="example-contents"><p>Пример ниже иллюстрирует использование Синглтона</p></div>
   <div class="example-contents"><div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$singleton&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">singleton</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;выведет&nbsp;"Создание&nbsp;нового&nbsp;экземпляра."<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;0<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;1<br /><br /></span><span style="color: #0000BB">$singleton&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">::</span><span style="color: #0000BB">singleton</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;вернет&nbsp;тот&nbsp;же&nbsp;самый&nbsp;экземпляр<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;2<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">increment</span><span style="color: #007700">();&nbsp;</span><span style="color: #FF8000">//&nbsp;3<br /><br />//&nbsp;все&nbsp;строки&nbsp;ниже&nbsp;вызывают&nbsp;неисправимую&nbsp;ошибку<br /></span><span style="color: #0000BB">$singleton2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Example</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$singleton3&nbsp;</span><span style="color: #007700">=&nbsp;clone&nbsp;</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$singleton4&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">unserialize</span><span style="color: #007700">(</span><span style="color: #0000BB">serialize</span><span style="color: #007700">(</span><span style="color: #0000BB">$singleton</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </div>
  <div class="warning"><b class="warning">Внимание</b>
   <p class="para">
    Паттерн Синглтон является одним из наиболее противоречивых паттернов. Критики утверждают, что
    Синглтоны вводят глобальные состояния при их применении и тесно связывают Синглтон
    и использующие его классы. Это приводит к скрытой зависимости и неожиданным побочным эффектам,
    что в свою очередь приводит к коду, который сложнее тестировать и поддерживать.
   </p>
   <p class="para">
    Критики также утверждаю, что не имеет смысла использовать Синглтон в архитектурах &quot;ничего общего&quot; (Shared Nothing Architecture), таких
 как PHP, где объекты являются уникальными в пределах запроса и никак иначе. Проще и аккуратнее
    создавать структуры взаимосвязанных объектов с помощью шаблонов Строителей(Builders) и Фабрики(Factory) за один раз
 в начале запроса.
   </p>
   <p class="para">
    Синглтоны также нарушают некоторые из &quot;Жестких&quot; принципов ООП проектирования и Закон Деметры.
    Синглтоны нельзя сериализовывать. Они не могут быть подклассами (до PHP 5.3) и не будут собираться
 сборщиком мусора из-за того, что экземпляр хранится в статическом атрибуте Синглтона.
   </p>
  </div>
 </div>

</div><hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="language.oop5.iterations.html">Итераторы объектов</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="language.oop5.magic.html">Магические методы</a></div>
 <div class="up"><a href="language.oop5.html">Классы и объекты</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
